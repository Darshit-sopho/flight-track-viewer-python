from PyQt6.QtWidgets import (
    QMainWindow, QWidget, QVBoxLayout, QSplitter, QProgressBar, QLabel
)
from PyQt6.QtCore import Qt, QByteArray
from PyQt6.QtGui import QFont, QIcon, QPixmap

# Modular Imports
from .widgets.control_panel import ControlPanel
from .widgets.leaflet_map import LeafletMapCanvas
from .widgets.plot_canvas import StaticPlotCanvas
from .widgets.animation_controls import AnimationControls
from .widgets.info_panel import InfoPanel
from .threads.processing_thread import ProcessingThread
from .utils.csv_parser import parse_flight_data
from .styles.stylesheet import STYLESHEET

class FlightTrackViewerUI(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Flight Track Viewer")

        orange_plane_base64 = """
        data:image/png;base64,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
        """
        pixmap = QPixmap()
        # Decode the Base64 string and load it into the pixmap
        pixmap.loadFromData(QByteArray.fromBase64(orange_plane_base64.encode()))
        
        # Set the icon for the Window
        self.setWindowIcon(QIcon(pixmap))

        self.resize(1400, 900)
        self.init_ui()
        self.apply_styles()

    def init_ui(self):
        main_widget = QWidget()
        self.setCentralWidget(main_widget)
        main_layout = QVBoxLayout(main_widget)

        # 1. Top Controls
        self.controls = ControlPanel()
        self.controls.process_requested.connect(self.start_processing)
        main_layout.addWidget(self.controls)

        # 2. Main Visualization Splitter
        splitter = QSplitter(Qt.Orientation.Horizontal)
        
        # Left: Map & Animation Controls
        left_container = QWidget()
        left_layout = QVBoxLayout(left_container)
        left_layout.addWidget(QLabel("Flight Track Map", font=QFont("Arial", 12, QFont.Weight.Bold)))
        
        self.map_view = LeafletMapCanvas()
        left_layout.addWidget(self.map_view)
        
        self.anim_controls = AnimationControls()
        self.anim_controls.frame_changed.connect(self.map_view.update_marker)
        left_layout.addWidget(self.anim_controls)
        
        splitter.addWidget(left_container)

        # Right: Plots & Info
        right_container = QWidget()
        right_layout = QVBoxLayout(right_container)
        
        self.alt_plot = StaticPlotCanvas(title="Altitude")
        right_layout.addWidget(self.alt_plot)
        
        self.speed_plot = StaticPlotCanvas(title="Speed")
        right_layout.addWidget(self.speed_plot)
        
        self.info_panel = InfoPanel()
        right_layout.addWidget(self.info_panel)
        
        splitter.addWidget(right_container)
        splitter.setSizes([800, 600])
        main_layout.addWidget(splitter)

        # 3. Status
        self.progress = QProgressBar()
        self.progress.setVisible(False)
        main_layout.addWidget(self.progress)

    def apply_styles(self):
        self.setStyleSheet(STYLESHEET)

    def start_processing(self, csv_file, config):
        self.progress.setVisible(True)
        self.progress.setValue(0)
        
        self.thread = ProcessingThread(csv_file, config)
        self.thread.progress.connect(lambda val, msg: (self.progress.setValue(val), self.statusBar().showMessage(msg)))
        self.thread.finished.connect(lambda res: self.processing_done(csv_file, res))
        self.thread.error.connect(lambda err: self.statusBar().showMessage(f"Error: {err}"))
        self.thread.start()

    def processing_done(self, csv_file, result):
        self.progress.setVisible(False)
        self.controls.reset_state()
        self.statusBar().showMessage("Processing Complete")
        
        # Parse data for UI display
        data, info_text = parse_flight_data(csv_file)
        
        # Update Widgets
        self.map_view.load_flight_data(data['lats'], data['lons'], data['heading'])
        self.anim_controls.setup(data['count'])
        
        if len(data['alt']) > 0: self.alt_plot.plot_data(data['alt'], "Altitude (ft)")
        if len(data['speed']) > 0: self.speed_plot.plot_data(data['speed'], "Speed (kts)")
            
        self.info_panel.update_info(info_text)